{{- $hasSecrets := false -}}
{{- if and .Values.providers .Values.providers.openrouter .Values.providers.openrouter.apiKey -}}
{{- $hasSecrets = true -}}
{{- end -}}
{{- if and .Values.providers .Values.providers.zhipu .Values.providers.zhipu.apiKey -}}
{{- $hasSecrets = true -}}
{{- end -}}
{{- if and .Values.providers .Values.providers.anthropic .Values.providers.anthropic.apiKey -}}
{{- $hasSecrets = true -}}
{{- end -}}
{{- if and .Values.channels .Values.channels.telegram .Values.channels.telegram.token -}}
{{- $hasSecrets = true -}}
{{- end -}}
{{- if and .Values.channels .Values.channels.discord .Values.channels.discord.token -}}
{{- $hasSecrets = true -}}
{{- end -}}
{{- if and (not (default "" .Values.existingSecret)) $hasSecrets -}}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "picoclaw.fullname" . }}
  labels:
    {{- include "picoclaw.labels" . | nindent 4 }}
type: Opaque
stringData:
  {{- if and .Values.providers .Values.providers.openrouter .Values.providers.openrouter.apiKey }}
  OPENROUTER_API_KEY: "{{ .Values.providers.openrouter.apiKey }}"
  {{- end }}
  {{- if and .Values.providers .Values.providers.zhipu .Values.providers.zhipu.apiKey }}
  ZHIPU_API_KEY: "{{ .Values.providers.zhipu.apiKey }}"
  {{- end }}
  {{- if and .Values.providers .Values.providers.anthropic .Values.providers.anthropic.apiKey }}
  ANTHROPIC_API_KEY: "{{ .Values.providers.anthropic.apiKey }}"
  {{- end }}
  {{- if and .Values.channels .Values.channels.telegram .Values.channels.telegram.token }}
  TELEGRAM_BOT_TOKEN: "{{ .Values.channels.telegram.token }}"
  {{- end }}
  {{- if and .Values.channels .Values.channels.discord .Values.channels.discord.token }}
  DISCORD_BOT_TOKEN: "{{ .Values.channels.discord.token }}"
  {{- end }}
{{- end -}}
